<div id="games">Carregando...</div>

<script>
async function loadGames() {
  const res = await fetch('/games');
  const games = await res.json();
  const container = document.getElementById('games');
  container.innerHTML = '';

  games.forEach(game => {
    const div = document.createElement('div');
    div.className = 'game';

    const isBackup = game.recommendation.includes('backup');

    const homeStats = game.stats.home;
    const awayStats = game.stats.away;

    const homeMatches = game.last5Matches.home?.map(m =>
      `‚Ä¢ ${m.date} ‚Äî ${m.homeTeam} ${m.homeGoals} x ${m.awayGoals} ${m.awayTeam} (${m.venue})`
    ).join('<br>') || '';

    const awayMatches = game.last5Matches.away?.map(m =>
      `‚Ä¢ ${m.date} ‚Äî ${m.homeTeam} ${m.homeGoals} x ${m.awayGoals} ${m.awayTeam} (${m.venue})`
    ).join('<br>') || '';

    const advancedId = `adv-${game.fixtureId}`;
    
    div.innerHTML = `
      <div class="teams">
        <img src="${game.homeLogo}" class="logo"> ${game.homeTeam}
        vs
        <img src="${game.awayLogo}" class="logo"> ${game.awayTeam}
      </div>
      <div class="time">üïí Hor√°rio: ${game.time}</div>
      <hr>
      <div class="stats-container">
        <div class="stats">
          <strong>${game.homeTeam} - M√©dias (√∫ltimos 5 jogos):</strong><br>
          ‚Ä¢ Gols feitos: ${homeStats.goalsFor}<br>
          ‚Ä¢ Gols sofridos: ${homeStats.goalsAgainst}<br>
          ‚Ä¢ Chutes: ${homeStats.shots}<br>
          ‚Ä¢ Chutes ao gol: ${homeStats.shotsOn}<br>
          ‚Ä¢ Escanteios: ${homeStats.corners}<br>
          ‚Ä¢ Cart√µes: ${homeStats.cards}
        </div>
        <div class="stats">
          <strong>${game.awayTeam} - M√©dias (√∫ltimos 5 jogos):</strong><br>
          ‚Ä¢ Gols feitos: ${awayStats.goalsFor}<br>
          ‚Ä¢ Gols sofridos: ${awayStats.goalsAgainst}<br>
          ‚Ä¢ Chutes: ${awayStats.shots}<br>
          ‚Ä¢ Chutes ao gol: ${awayStats.shotsOn}<br>
          ‚Ä¢ Escanteios: ${awayStats.corners}<br>
          ‚Ä¢ Cart√µes: ${awayStats.cards}
        </div>
      </div>

      <div class="recent-matches">
        <strong>√öltimos 5 jogos de ${game.homeTeam}:</strong><br>${homeMatches}<br><br>
        <strong>√öltimos 5 jogos de ${game.awayTeam}:</strong><br>${awayMatches}
      </div>

      <button onclick="toggleAdvanced('${advancedId}')">+ Ver an√°lise avan√ßada</button>
      <div id="${advancedId}" style="display:none; margin-top: 10px; font-size: 14px;">
        <hr>
        <strong>üìä Previs√£o:</strong><br>
        ‚Ä¢ Palpite: ${game.prediction.advice}<br>
        ‚Ä¢ ${game.homeTeam}: ${game.prediction.win_percent.home}%<br>
        ‚Ä¢ Empate: ${game.prediction.win_percent.draw}%<br>
        ‚Ä¢ ${game.awayTeam}: ${game.prediction.win_percent.away}%<br><br>

        <strong>üèÜ Classifica√ß√£o:</strong><br>
        ${getStanding(game.standings, game.homeTeam)}<br>
        ${getStanding(game.standings, game.awayTeam)}<br><br>

        <strong>üí∏ Odds:</strong><br>
        ‚Ä¢ ${game.homeTeam}: ${game.odds.home ?? '-'}<br>
        ‚Ä¢ Empate: ${game.odds.draw ?? '-'}<br>
        ‚Ä¢ ${game.awayTeam}: ${game.odds.away ?? '-'}<br>
        ‚Ä¢ Over 2.5: ${game.odds.over25 ?? '-'}<br>
        ‚Ä¢ Ambos marcam: ${game.odds.btts ?? '-'}
      </div>

      <div class="rec ${isBackup ? 'rec-backup' : ''}">üîé ${game.recommendation}</div>
    `;

    container.appendChild(div);
  });
}

function toggleAdvanced(id) {
  const el = document.getElementById(id);
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}

function getStanding(standings, teamName) {
  const team = standings?.find(t => t.team.name === teamName);
  if (!team) return `‚Ä¢ ${teamName}: classifica√ß√£o indispon√≠vel`;
  return `‚Ä¢ ${team.team.name} - ${team.rank}¬∫ lugar | ${team.points} pts | ${team.all.played} jogos (${team.all.win}V ${team.all.draw}E ${team.all.lose}D)`;
}

loadGames();
</script>
